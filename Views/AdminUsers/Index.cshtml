@model WedNightFury.Controllers.AdminUserListViewModel

@{
    ViewData["Title"] = "Qu·∫£n l√Ω ng∆∞·ªùi d√πng";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<style>
    /* ===== Match style with your Customer Dashboard (dash) ===== */
    .dash {
        --bg: #ffffff;
        --text: #111827;
        --muted: #6b7280;
        --border: rgba(17, 24, 39, 0.10);
        --shadow: 0 10px 30px rgba(17, 24, 39, 0.08);
        --shadow2: 0 14px 40px rgba(17, 24, 39, 0.10);
        color: var(--text);
        font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
    }

    /* Header block like dashboard */
    .dash-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 14px;
        padding: 14px 16px;
        border-radius: 16px;
        border: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(13, 110, 253, 0.08), rgba(13, 110, 253, 0.02));
        box-shadow: var(--shadow);
        margin-bottom: 14px;
    }
    .dash-head__left { display:flex; gap: 12px; align-items:center; }
    .dash-avatar{
        width: 44px; height: 44px; border-radius: 14px;
        display: grid; place-items: center;
        background: #fff; border: 1px solid var(--border);
        box-shadow: 0 8px 24px rgba(17, 24, 39, 0.08);
        font-size: 20px;
        flex: 0 0 auto;
    }
    .dash-title{ font-weight: 900; letter-spacing: -0.2px; font-size: 1.15rem; margin:0; }
    .dash-sub{
        margin-top: 4px;
        color: var(--muted);
        font-size: 0.95rem;
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
    }
    .dash-dot{
        width: 6px; height: 6px;
        border-radius: 99px;
        background: rgba(17,24,39,0.25);
        display: inline-block;
    }

    .dash-pill{
        display: inline-flex; align-items: center; gap: 10px;
        padding: 10px 12px; border-radius: 999px;
        border: 1px solid var(--border); background: #fff;
        box-shadow: 0 8px 18px rgba(17, 24, 39, 0.06);
        color: var(--muted); font-weight: 800; font-size: 0.9rem;
        user-select: none;
        white-space: nowrap;
    }
    .pill-dot{
        width: 10px; height: 10px; border-radius: 99px;
        background: #22c55e;
        box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.18);
    }

    /* Panels */
    .panel{
        border-radius: 18px;
        border: 1px solid var(--border);
        background: #fff;
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: transform .18s ease, box-shadow .18s ease;
    }
    .panel:hover{ transform: translateY(-2px); box-shadow: var(--shadow2); }

    .panel-head{
        padding: 14px 16px;
        border-bottom: 1px solid rgba(17, 24, 39, 0.08);
        background: linear-gradient(180deg, rgba(17, 24, 39, 0.03), rgba(17, 24, 39, 0.01));
        display:flex; align-items:center; justify-content:space-between;
        gap: 12px; flex-wrap: wrap;
    }
    .panel-title{ font-weight: 950; letter-spacing: -0.2px; }
    .panel-sub{ color: var(--muted); font-size: 0.92rem; margin-top: 4px; }

    .panel-body{ padding: 14px 16px 16px 16px; }

    /* Filter look */
    .filter-box .form-label{
        font-weight: 800;
        color: var(--text);
        font-size: .9rem;
    }
    .filter-actions .btn{
        border-radius: 999px;
        font-weight: 800;
        padding: .55rem .85rem;
    }
    .filter-actions .btn-light{
        background: #fff;
    }

    .stat-mini{
        border: 1px dashed rgba(17,24,39,0.16);
        background: rgba(17,24,39,0.02);
        border-radius: 14px;
        padding: 12px;
    }
    .stat-mini .title{
        font-weight: 950;
        margin-bottom: 6px;
        color: var(--text);
    }

    /* Table style like dashboard */
    .table-clean{
        margin:0;
    }
    .table-clean thead th{
        background: rgba(17,24,39,0.03) !important;
        font-weight: 900;
        color: var(--text);
        border-bottom: 1px solid rgba(17,24,39,0.10) !important;
        white-space: nowrap;
    }
    .table-clean td, .table-clean th{
        padding: .85rem .95rem;
        vertical-align: middle;
        border-color: rgba(17,24,39,0.06);
    }
    .table-clean tbody tr{
        transition: background .12s ease;
    }
    .table-clean tbody tr:hover{
        background: rgba(13,110,253,.04);
    }

    /* Badges like dashboard pills */
    .badge-pill{
        border-radius: 999px;
        padding: .35rem .65rem;
        font-weight: 900;
        letter-spacing: .01em;
        display:inline-flex;
        align-items:center;
        gap: 6px;
    }
    .role-dot{
        width: 8px;
        height: 8px;
        border-radius: 50%;
        box-shadow: 0 0 0 3px rgba(0,0,0,.03);
    }

    /* Pagination */
    .pagination .page-link{
        border-radius: 999px !important;
        margin: 0 3px;
        font-weight: 900;
        color:#0d6efd;
        border: 1px solid rgba(13,110,253,.18);
        background: rgba(13,110,253,.04);
        transition: transform .12s ease, background .12s ease;
    }
    .pagination .page-link:hover{
        background: rgba(13,110,253,.08);
        transform: translateY(-1px);
    }
    .pagination .page-item.active .page-link{
        background: #0d6efd;
        border-color: #0d6efd;
        color:#fff;
    }
    .pagination .page-item.disabled .page-link{
        opacity: .55;
        transform:none;
    }

    /* Responsive */
    @@media (max-width: 992px){
        .dash-head{ align-items:flex-start; }
    }
</style>

<div class="dash container-fluid">

    <!-- Header gi·ªëng Dashboard -->
    <div class="dash-head">
        <div class="dash-head__left">
            <div class="dash-avatar">üë•</div>
            <div>
                <h2 class="dash-title">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
                <div class="dash-sub">
                    L·ªçc theo vai tr√≤, t√¨m ki·∫øm nhanh v√† qu·∫£n l√Ω danh s√°ch t√†i kho·∫£n
                    <span class="dash-dot"></span>
                    <span class="text-muted">T·ªïng: <b>@Model.TotalCount</b></span>
                </div>
            </div>
        </div>

        <div class="dash-head__right">
            <a asp-action="CreateDriver" class="dash-pill" style="text-decoration:none;">
                <span class="pill-dot"></span>
                <span><i class="fas fa-plus me-1"></i> T·∫°o t√†i kho·∫£n t√†i x·∫ø</span>
            </a>
        </div>
    </div>

    <div class="row g-3 mb-3">

        <!-- B·ªô l·ªçc -->
        <div class="col-lg-3">
            <div class="panel filter-box">
                <div class="panel-head">
                    <div>
                        <div class="panel-title"><i class="fas fa-filter me-1"></i> B·ªô l·ªçc</div>
                        <div class="panel-sub">Ch·ªçn vai tr√≤ ho·∫∑c nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ thu h·∫πp k·∫øt qu·∫£.</div>
                    </div>
                </div>

                <div class="panel-body">
                    <form method="get" asp-action="Index">
                        <div class="mb-3">
                            <label class="form-label">Vai tr√≤</label>
                            @{
                                string role = Model.RoleFilter ?? "all";
                            }
                            <select name="role" class="form-select">
                                <option value="all" selected="@(role == "all")">T·∫•t c·∫£</option>
                                <option value="admin" selected="@(role == "admin")">Qu·∫£n tr·ªã</option>
                                <option value="customer" selected="@(role == "customer")">Kh√°ch h√†ng</option>
                                <option value="driver" selected="@(role == "driver")">T√†i x·∫ø</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">T·ª´ kh√≥a</label>
                            <input type="text"
                                   name="search"
                                   value="@Model.Search"
                                   class="form-control"
                                   placeholder="T√™n / Email / SƒêT / C√¥ng ty" />
                        </div>

                        <div class="d-grid gap-2 filter-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-filter me-1"></i> L·ªçc
                            </button>
                            <a asp-action="Index" class="btn btn-light border">
                                X√≥a b·ªô l·ªçc
                            </a>
                        </div>

                        @if (Model.RoleStats.Any())
                        {
                            <hr />
                            <div class="stat-mini small text-muted">
                                <div class="title">Th·ªëng k√™ vai tr√≤</div>
                                @foreach (var kv in Model.RoleStats.OrderBy(k => k.Key))
                                {
                                    <div class="d-flex justify-content-between">
                                        <span>@kv.Key</span>
                                        <strong class="text-dark">@kv.Value</strong>
                                    </div>
                                }
                            </div>
                        }
                    </form>
                </div>
            </div>
        </div>

        <!-- Danh s√°ch ng∆∞·ªùi d√πng -->
        <div class="col-lg-9">
            <div class="panel">
                <div class="panel-head">
                    <div>
                        <div class="panel-title"><i class="fas fa-users me-1"></i> Danh s√°ch ng∆∞·ªùi d√πng</div>
                        <div class="panel-sub">T·ªïng s·ªë b·∫£n ghi: <b>@Model.TotalCount</b></div>
                    </div>

                    <a asp-action="CreateDriver" class="btn btn-primary btn-sm" style="border-radius:999px;font-weight:900;">
                        <i class="fas fa-plus me-1"></i> T·∫°o t√†i kho·∫£n t√†i x·∫ø
                    </a>
                </div>

                <div class="table-responsive">
                    <table class="table table-clean table-hover mb-0 align-middle">
                        <thead>
                            <tr>
                                <th style="width:70px;">#</th>
                                <th>T√†i kho·∫£n</th>
                                <th>Email</th>
                                <th>SƒêT</th>
                                <th>Vai tr√≤</th>
                                <th>C√¥ng ty</th>
                                <th class="text-nowrap">Ng√†y t·∫°o</th>
                            </tr>
                        </thead>
                        <tbody>
                        @if (Model.Users != null && Model.Users.Count > 0)
                        {
                            int index = (Model.Page - 1) * Model.PageSize + 1;
                            foreach (var u in Model.Users)
                            {
                                <tr>
                                    <td class="text-muted fw-bold">@index</td>
                                    <td class="fw-bold">@u.UserName</td>
                                    <td>@u.Email</td>
                                    <td>@u.Phone</td>
                                    <td>
                                        @{
                                            string badgeClass = u.Role?.ToLower() switch
                                            {
                                                "admin"    => "danger",
                                                "driver"   => "info",
                                                "customer" => "success",
                                                _          => "secondary"
                                            };

                                            string dotClass = u.Role?.ToLower() switch
                                            {
                                                "admin"    => "bg-danger",
                                                "driver"   => "bg-info",
                                                "customer" => "bg-success",
                                                _          => "bg-secondary"
                                            };
                                        }
                                        <span class="badge bg-@badgeClass badge-pill">
                                            <span class="role-dot @dotClass"></span>
                                            @u.Role
                                        </span>
                                    </td>
                                    <td>@u.CompanyName</td>
                                    <td class="text-nowrap">@u.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                                </tr>
                                index++;
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="7" class="text-center text-muted py-4">
                                    Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†o.
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>

                <!-- Ph√¢n trang -->
                @if (Model.TotalPages > 1)
                {
                    <div class="card-footer bg-white border-0">
                        <nav>
                            <ul class="pagination mb-0 flex-wrap">
                                <li class="page-item @(Model.Page <= 1 ? "disabled" : "")">
                                    <a class="page-link"
                                       asp-action="Index"
                                       asp-route-page="@(Model.Page - 1)"
                                       asp-route-role="@Model.RoleFilter"
                                       asp-route-search="@Model.Search">Tr∆∞·ªõc</a>
                                </li>

                                @for (int i = 1; i <= Model.TotalPages; i++)
                                {
                                    <li class="page-item @(i == Model.Page ? "active" : "")">
                                        <a class="page-link"
                                           asp-action="Index"
                                           asp-route-page="@i"
                                           asp-route-role="@Model.RoleFilter"
                                           asp-route-search="@Model.Search">@i</a>
                                    </li>
                                }

                                <li class="page-item @(Model.Page >= Model.TotalPages ? "disabled" : "")">
                                    <a class="page-link"
                                       asp-action="Index"
                                       asp-route-page="@(Model.Page + 1)"
                                       asp-route-role="@Model.RoleFilter"
                                       asp-route-search="@Model.Search">Sau</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
