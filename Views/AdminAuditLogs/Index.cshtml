@model IEnumerable<WedNightFury.Models.AuditLog>

@{
    ViewData["Title"] = "Nh·∫≠t k√Ω thao t√°c";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";

    DateTime? fromDate = ViewBag.From as DateTime?;
    DateTime? toDate   = ViewBag.To as DateTime?;
    string currentAction     = ViewBag.Action as string ?? "all";
    string currentEntityType = ViewBag.EntityType as string ?? "all";
    string keyword           = ViewBag.Keyword as string ?? "";
}

<div class="container-fluid px-4 py-3">

    <!-- DASH HEADER -->
    <div class="dash-head mb-3">
        <div class="dash-head__left">
            <div class="dash-avatar">üìú</div>
            <div>
                <div class="dash-title">Nh·∫≠t k√Ω thao t√°c</div>
                <div class="dash-sub">
                    Theo d√µi to√†n b·ªô h√†nh ƒë·ªông c·ªßa admin trong h·ªá th·ªëng
                </div>
            </div>
        </div>
        <div class="dash-pill">
            <span class="pill-dot"></span>
            <span>Audit Log</span>
        </div>
    </div>

    <!-- FILTER PANEL -->
    <div class="panel mb-3">
        <div class="panel-head">
            <div class="panel-title">
                <i class="fas fa-filter me-1"></i> B·ªô l·ªçc
            </div>
        </div>
        <div class="panel-body">
            <form method="get" class="row g-3 align-items-end">

                <div class="col-md-2">
                    <label class="form-label fw-bold">T·ª´ ng√†y</label>
                    <input type="date" name="from" class="form-control"
                           value="@(fromDate?.ToString("yyyy-MM-dd") ?? "")" />
                </div>

                <div class="col-md-2">
                    <label class="form-label fw-bold">ƒê·∫øn ng√†y</label>
                    <input type="date" name="to" class="form-control"
                           value="@(toDate?.ToString("yyyy-MM-dd") ?? "")" />
                </div>

                <div class="col-md-2">
                    <label class="form-label fw-bold">H√†nh ƒë·ªông</label>
                    <select name="action" class="form-select">
                        <option value="all">T·∫•t c·∫£</option>
                        <option value="login"  selected="@(currentAction=="login")">Login</option>
                        <option value="create" selected="@(currentAction=="create")">Create</option>
                        <option value="update" selected="@(currentAction=="update")">Update</option>
                        <option value="delete" selected="@(currentAction=="delete")">Delete</option>
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="form-label fw-bold">ƒê·ªëi t∆∞·ª£ng</label>
                    <select name="entityType" class="form-select">
                        <option value="all">T·∫•t c·∫£</option>
                        <option value="User"      selected="@(currentEntityType=="User")">User</option>
                        <option value="Driver"    selected="@(currentEntityType=="Driver")">Driver</option>
                        <option value="Order"     selected="@(currentEntityType=="Order")">Order</option>
                        <option value="Promotion" selected="@(currentEntityType=="Promotion")">Promotion</option>
                        <option value="System"    selected="@(currentEntityType=="System")">System</option>
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label fw-bold">T·ª´ kh√≥a</label>
                    <input name="keyword" class="form-control"
                           placeholder="Admin / m√¥ t·∫£ / IP"
                           value="@keyword" />
                </div>

                <div class="col-md-1 d-grid">
                    <button class="btn btn-primary">L·ªçc</button>
                </div>
            </form>
        </div>
    </div>

    <!-- TABLE -->
    <div class="panel">
        <div class="panel-head">
            <div class="panel-title">
                <i class="fas fa-list me-1"></i> Danh s√°ch log
            </div>
        </div>

        <div class="panel-body p-0">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Th·ªùi gian</th>
                        <th>Admin</th>
                        <th>H√†nh ƒë·ªông</th>
                        <th>ƒê·ªëi t∆∞·ª£ng</th>
                        <th>M√¥ t·∫£</th>
                        <th>IP</th>
                    </tr>
                </thead>
                <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var log in Model)
                    {
                        string actionClass = log.Action switch
                        {
                            "login"  => "bg-info",
                            "create" => "bg-success",
                            "update" => "bg-warning text-dark",
                            "delete" => "bg-danger",
                            _ => "bg-secondary"
                        };

                        <tr>
                            <td class="text-muted small">
                                @log.CreatedAt.ToString("dd/MM/yyyy HH:mm:ss")
                            </td>
                            <td class="fw-semibold">
                                @log.AdminName
                                <div class="small text-muted">#@log.AdminId</div>
                            </td>
                            <td>
                                <span class="badge @actionClass badge-pill">
                                    @log.Action
                                </span>
                            </td>
                            <td>
                                <span class="badge bg-light text-dark badge-pill">
                                    @log.EntityType
                                    @(log.EntityId.HasValue ? $"#{log.EntityId}" : "")
                                </span>
                            </td>
                            <td class="small">@log.Description</td>
                            <td class="text-muted small">@log.IpAddress</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            Kh√¥ng c√≥ log ph√π h·ª£p ƒëi·ªÅu ki·ªán l·ªçc.
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>
</div>
